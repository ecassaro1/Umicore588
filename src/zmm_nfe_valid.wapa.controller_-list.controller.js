sap.ui.define(["umicore/mm/nfevalid/zmmnfevalid/controller/Base.controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","umicore/mm/nfevalid/zmmnfevalid/model/formatter","sap/ui/core/Fragment","sap/m/Token","sap/m/Se+
archField","sap/ui/model/resource/ResourceModel","umicore/mm/nfevalid/zmmnfevalid/controller/Excel1","umicore/mm/nfevalid/zmmnfevalid/controller/Excel2","umicore/mm/nfevalid/zmmnfevalid/controller/Excel3","umicore/mm/nfevalid/zmmnfevalid/controller/Excel+
4"],function(e,t,i,o,l,n,a,s,r,u,c,h,g){"use strict";return e.extend("umicore.mm.nfevalid.zmmnfevalid.controller.List",{formatter:l,oView:null,onInit:function(){this.oView=this.getView();var e=new r({bundleName:"umicore.mm.nfevalid.zmmnfevalid.i18n.i18n"+
});this.getView().setModel(e,"i18n");this._setUserSHCols();this._oInput=this.getView().byId("ekkoUser")},onSfbInitialized:function(e){var t=e.getSource();var i=t.getControlByKey("CompanyCode");this.disable(this.getView(),i);this.getView().getModel().setS+
izeLimit(1e5);t.search()},onSearch:function(e){this.getView().setBusy(true);var t=e.getSource();this.doSearch(t)},doSearch:function(e){var t=e.getFilters();var i=this.getView().getModel();i.read("/eDoc",{filters:t,urlParameters:"top=3000",success:o.bind(+
this),error:function(){this.getView().setBusy(false);debugger}});function o(e){this.eDocJsonFill(e.results);this.getView().setBusy(false)}},getFilters:function(){var e=[];var t=this.getView().byId("ekkoUser").getValue();if(t){var l=new i("EkkoUser",o.Con+
tains,t);e.push(l)}var n=this.getView().byId("infnfeEmitCnpj").getValue();if(n){var a=new i("InfnfeEmitCnpj",o.EQ,this.cnpjUnmask(n));e.push(a)}return e},eDocJsonFill:function(e){var i={eDocJson:e};var o=new t(i);this.getView().setModel(o,"local");let l=+
this.getFilters();this.byId("baseTable").getBinding("items").filter(l)},listRefresh:function(){var e=this.getView().byId("smartFilterBar");this.doSearch(e)},onListItemPressed:function(e){var t=e.getSource();var i=t.getBindingContextPath();var o=this.getV+
iew().getModel("local");var l=o.getProperty(i);if(l.StatusValid=="C"){return}var n=this.getGlobalModel();var a=n.getData();a.listRow={sPath:"/eDoc('"+l.Accesskey+"')",oData:l};a.oListView=this;n.setData(a);this.getRouter().navTo("RouteObject",{object:""}+
)},_setUserSHCols:function(){this.oColModel=new t({cols:[{label:this.getI18nText("UserKey"),template:"BName"},{label:this.getI18nText("UserName"),template:"NameText"}]})},onUserValueHelpRequested:function(){var e=this.oColModel.getData().cols;this._oBasi+
cSearchField=new s;n.load({name:"umicore.mm.nfevalid.zmmnfevalid.view.UserValueHelp",controller:this}).then(function t(i){this._oValueHelpDialog=i;this.getView().addDependent(this._oValueHelpDialog);var o=this._oValueHelpDialog.getFilterBar();o.setFilter+
BarExpanded(false);o.setBasicSearch(this._oBasicSearchField);this._oValueHelpDialog.getTableAsync().then(function(t){t.setModel(this.oProductsModel);t.setModel(this.oColModel,"columns");if(t.bindRows){t.bindAggregation("rows","/User")}if(t.bindItems){t.b+
indAggregation("items","/User",function(){return new ColumnListItem({cells:e.map(function(e){return new Label({text:"{"+e.template+"}"})})})})}this._oValueHelpDialog.update()}.bind(this));var l=new a;l.setKey(this._oInput.getSelectedKey());l.setText(this+
._oInput.getValue());this._oValueHelpDialog.setTokens([l]);this._oValueHelpDialog.open()}.bind(this))},onFilterBarSearch:function(e){var t=this._oBasicSearchField.getValue(),l=e.getParameter("selectionSet");var n=l.reduce(function(e,t){if(t.getValue()){e+
.push(new i({path:t.getName(),operator:o.Contains,value1:t.getValue()}))}return e},[]);n.push(new i({filters:[new i({path:"BName",operator:o.Contains,value1:t}),new i({path:"NameText",operator:o.Contains,value1:t})],and:false}));this._filterTable(new i({+
filters:n,and:true}))},_filterTable:function(e){var t=this._oValueHelpDialog;t.getTableAsync().then(function(i){if(i.bindRows){i.getBinding("rows").filter(e)}if(i.bindItems){i.getBinding("items").filter(e)}t.update()})},onUserValueHelpOkPress:function(e)+
{var t=e.getParameter("tokens");if(t.length>0){this._oInput.setValue(t[0].getKey())}this._oValueHelpDialog.close()},onUserValueHelpCancelPress:function(){this._oValueHelpDialog.close()},onUserValueHelpAfterClose:function(){this._oValueHelpDialog.destroy(+
)},onDataExport:function(e){var t=this.getView().getModel("local");let i=n(this.getView(),t.getData().eDocJson);if(i.length==0)return;var o=this.getOwnerComponent();o.setModel(i,"localShort");var l=e.getSource().getProperty("text");switch(l){case this.ge+
tI18nText("Excel1"):u(o,this.getView());break;case this.getI18nText("Excel2"):c(o,this.getView());break;case this.getI18nText("Excel3"):h(o,this.getView());break;case this.getI18nText("Excel4"):g(o,this.getView());break}function n(e,t){let i=e.byId("ekko+
User").getValue().toUpperCase();let o=e.byId("infnfeEmitCnpj").getValue().replace(/[\./-]/g,"");let l=[];for(let e=0;e<t.length;e++){if(i){if(!t[e].EkkoUser.includes(i)){continue}}if(o){if(t[e].InfnfeEmitCnpj!=o){continue}}l.push(t[e])}return l}}})});    