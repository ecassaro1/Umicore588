//Relatório Geral-Divergências                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
sap.ui.define([                                                                                                                                                                                                                                                
	'sap/ui/core/util/Export',                                                                                                                                                                                                                                    
	'sap/ui/core/util/ExportTypeCSV',                                                                                                                                                                                                                             
    'sap/ui/export/Spreadsheet',                                                                                                                                                                                                                               
	"sap/ui/model/Filter",                                                                                                                                                                                                                                        
	"sap/ui/model/FilterOperator",                                                                                                                                                                                                                                
    "sap/ui/model/json/JSONModel"                                                                                                                                                                                                                              
],	                                                                                                                                                                                                                                                            
	function (Export,ExportTypeCSV,Spreadsheet,Filter,FilterOperator,JSONModel) {                                                                                                                                                                                 
		"use strict";                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
        let API = {                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            OC: null,                                                                                                                                                                                                                                          
            oView: null,                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            localFull: {},                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
            Export: function (iOC,iView) {                                                                                                                                                                                                                     
                this.OC = iOC;                                                                                                                                                                                                                                 
                this.oView = iView;                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                iView.setBusy(true);                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                this._fetchFull().then(                                                                                                                                                                                                                        
                    this._enrichIt.bind(this),  //resolve                                                                                                                                                                                                      
                    (error)=>{                  //reject                                                                                                                                                                                                       
                        debugger;                                                                                                                                                                                                                              
                    }                                                                                                                                                                                                                                          
                ).then(this._exportIt.bind(this));                                                                                                                                                                                                             
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            _fetchFull: async function() {                                                                                                                                                                                                                     
                var aLocalShort = this.OC.getModel("localShort");                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var defaultModel = this.OC.getModel();                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                var aFilters = _buildFilters(aLocalShort);                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                //fetch the full data                                                                                                                                                                                                                          
                return new Promise(                                                                                                                                                                                                                            
                    (resolve,reject)=>{                                                                                                                                                                                                                        
                        defaultModel.read(                                                                                                                                                                                                                     
                            "/XML_Cod",                                                                                                                                                                                                                        
                            {                                                                                                                                                                                                                                  
                                 urlParameters: {                                                                                                                                                                                                              
                                    "$expand": "to_Header/to_eDoc,to_Header/to_Items",                                                                                                                                                                         
                                    "$top" : "100000"                                                                                                                                                                                                          
                                },                                                                                                                                                                                                                             
                                filters: aFilters,                                                                                                                                                                                                             
                                success: (oData)=>{resolve(oData)},                                                                                                                                                                                            
                                error: (error)=>{reject(error)}                                                                                                                                                                                                
                            }                                                                                                                                                                                                                                  
                        );&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                             
                    }                                                                                                                                                                                                                                          
                );                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                function _buildFilters(aShort) {                                                                                                                                                                                                               
                    var aFilters = [];                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    aShort.forEach((oShort)=>{                                                                                                                                                                                                                 
                        var oFilter = new Filter(                                                                                                                                                                                                              
                            "Chave",                                                                                                                                                                                                                           
                            FilterOperator.EQ,                                                                                                                                                                                                                 
                            oShort.Accesskey                                                                                                                                                                                                                   
                        );                                                                                                                                                                                                                                     
                        aFilters.push(oFilter);                                                                                                                                                                                                                
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    return aFilters;                                                                                                                                                                                                                           
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            _enrichIt: function(oData) {                                                                                                                                                                                                                       
                var aRich = oData.results.map((oFull)=>{                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    var oRich = oFull;                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    //Items                                                                                                                                                                                                                                    
                    if (oFull.to_Header&&oFull.to_Header.to_Items) {                                                                                                                                                                                           
                        var aXPed = [];                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        oFull.to_Header.to_Items.results.forEach((item)=>{                                                                                                                                                                                     
                            if (aXPed.includes(item.XPed)) {                                                                                                                                                                                                   
                            //for not to push the same item twice                                                                                                                                                                                              
                                return;                                                                                                                                                                                                                        
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            aXPed.push(item.XPed);                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                            //Pedidos                                                                                                                                                                                                                          
                            oRich.Pedidos =&nbsp;                                                                                                                                                                                                              
                                    ( oRich.Pedidos ? oRich.Pedidos + "/" : "" )&nbsp;                                                                                                                                                                         
                                +   item.XPed;                                                                                                                                                                                                                 
                        });                                                                                                                                                                                                                                    
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    //Divergencies                                                                                                                                                                                                                             
                    if (oFull.to_xml) { //if there is no xml (transaction) then it´s undefined                                                                                                                                                                 
                        oRich.Divergencias =&nbsp;                                                                                                                                                                                                             
                            (oFull.to_xml.Divergencias)                                                                                                                                                                                                        
                            ? "Sim"                                                                                                                                                                                                                            
                            : "Não";                                                                                                                                                                                                                           
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    //                                                                                                                                                                                                                                         
                    return oRich;                                                                                                                                                                                                                              
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                return aRich;                                                                                                                                                                                                                                  
            },                                                                                                                                                                                                                                                 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                           
            _exportIt(oData) {                                                                                                                                                                                                                                 
                //sample do UI5                                                                                                                                                                                                                                
                // https://sapui5.hana.ondemand.com/#/entity/sap.m.Table/sample/sap.m.sample.TableExport                                                                                                                                                       
                                                                                                                                                                                                                                                               
                var oModel = new JSONModel(oData);                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                var oExport = new Export({                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                    // Type that will be used to generate the content. Own ExportType's can be created to support other formats                                                                                                                                
                    exportType : new ExportTypeCSV({                                                                                                                                                                                                           
                        separatorChar : ";"                                                                                                                                                                                                                    
                    }),                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    // Pass in the model created above                                                                                                                                                                                                         
                    models : oModel,                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    // binding information for the rows aggregation                                                                                                                                                                                            
                    rows : {                                                                                                                                                                                                                                   
                        path : "/"                                                                                                                                                                                                                             
                    },                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    // column definitions with column name and binding info for the content                                                                                                                                                                    
                    columns : [                                                                                                                                                                                                                                
                        {                                                                                                                                                                                                                                      
                            name : "Status De Controle",                                                                                                                                                                                                       
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts: ["to_Header/to_eDoc/Status"],                                                                                                                                                                                       
                                    formatter : function(status) {                                                                                                                                                                                             
                                        if (!status) return;                                                                                                                                                                                                   
                                        switch(status) {                                                                                                                                                                                                       
                                            case "0": return "Indefinido";                                                                                                                                                                                     
                                            case "1": return "Liberado";                                                                                                                                                                                       
                                            case "2": return "Arquivado";                                                                                                                                                                                      
                                            case "3": return "Desfeito";                                                                                                                                                                                       
                                            case "9": return "Rejeitado";                                                                                                                                                                                      
                                            default: return "Indefinido";                                                                                                                                                                                      
                                        }                                                                                                                                                                                                                      
                                    }                                                                                                                                                                                                                          
                                }&nbsp;                                                                                                                                                                                                                        
                            }                                                                                                                                                                                                                                  
                        },                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                       
                        {                                                                                                                                                                                                                                      
                            name : "Mês de Emissão",                                                                                                                                                                                                           
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts : ["to_Header/to_eDoc/InfnfeIdeDhemi"],                                                                                                                                                                              
                                    formatter : function(dtIn) {                                                                                                                                                                                               
                                        if (!dtIn) return;                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                        var dtOut = dtIn.substr(3,2);                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                        switch(dtOut) {                                                                                                                                                                                                        
                                            case "01": return "Janeiro";                                                                                                                                                                                       
                                            case "02": return "Fevereiro";                                                                                                                                                                                     
                                            case "03": return "Março";                                                                                                                                                                                         
                                            case "04": return "Abril";                                                                                                                                                                                         
                                            case "05": return "Maio";                                                                                                                                                                                          
                                            case "06": return "Junho";                                                                                                                                                                                         
                                            case "07": return "Julho";                                                                                                                                                                                         
                                            case "08": return "Agosto";                                                                                                                                                                                        
                                            case "09": return "Setembro";                                                                                                                                                                                      
                                            case "10": return "Outubro";                                                                                                                                                                                       
                                            case "11": return "Novembro";                                                                                                                                                                                      
                                            case "12": return "Dezembro";                                                                                                                                                                                      
                                        }                                                                                                                                                                                                                      
                                    }                                                                                                                                                                                                                          
                                }	                                                                                                                                                                                                                             
                            }                                                                                                                                                                                                                                  
                        },                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "Data de Emissão",                                                                                                                                                                                                          
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts: ["to_Header/to_eDoc/InfnfeIdeDhemi"],                                                                                                                                                                               
                                }&nbsp;                                                                                                                                                                                                                        
                            }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                          
                        },                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "Número da Nfe",                                                                                                                                                                                                            
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts: ["to_Header/to_eDoc/Nfenum"],                                                                                                                                                                                       
                                }&nbsp;                                                                                                                                                                                                                        
                            }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                              
                        },&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                     
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "Número da Nfe de Referência",                                                                                                                                                                                              
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts: ["to_Header/to_eDoc/InfnfeIdeNfrefNnf"],                                                                                                                                                                            
                                }&nbsp;                                                                                                                                                                                                                        
                            }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                              
                        },&nbsp;                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "Tipo NFe",                                                                                                                                                                                                                 
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts : ["to_Header/to_eDoc/InfnfeIdeTpnf"],                                                                                                                                                                               
                                    formatter : function(tp) {                                                                                                                                                                                                 
                                        if (!tp) return;                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                        switch (tp) {                                                                                                                                                                                                          
                                            case "0": return "0 - Entrada";                                                                                                                                                                                    
                                            case "1": return "1 - Saída";                                                                                                                                                                                      
                                        }                                                                                                                                                                                                                      
                                    }                                                                                                                                                                                                                          
                                }	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                             
                            }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                          
                        },                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "Finalidade",                                                                                                                                                                                                               
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts : ["to_Header/to_eDoc/InfnfeIdeFinnfe"],                                                                                                                                                                             
                                    formatter : function(fin) {                                                                                                                                                                                                
                                        if (!fin) return;                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                                        switch (fin) {                                                                                                                                                                                                         
                                            case "1": return "1 - Normal";                                                                                                                                                                                     
                                            case "2": return "2 - Complementar";                                                                                                                                                                               
                                            case "3": return "3 - NF-e de ajuste";                                                                                                                                                                             
                                            case "4": return "4 - Devolução de Mercadoria";                                                                                                                                                                    
                                        }                                                                                                                                                                                                                      
                                    }                                                                                                                                                                                                                          
                                }	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                             
                            }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                          
                        },                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "Natureza da Operação",                                                                                                                                                                                                     
                            template : {                                                                                                                                                                                                                       
                                content : {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                    
                                parts : ["to_Header/to_eDoc/InfnfeIdeNatOp"],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb+
sp;&nbsp;&nbsp;                                                                                                                                                                                                                                                
                            }                                                                                                                                                                                                                                  
                          }                                                                                                                                                                                                                                    
                        },                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "Código Divergência",                                                                                                                                                                                                       
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts : ["CodDiv"],                                                                                                                                                                                                        
                                    formatter : function(codDiv) {                                                                                                                                                                                             
                                        if (!codDiv) return;                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                        return "'"+codDiv+"'";                                                                                                                                                                                                 
                                    }                                                                                                                                                                                                                          
                                }                                                                                                                                                                                                                              
                            }&nbsp;                                                                                                                                                                                                                            
                        },                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "Descrição Divergência",                                                                                                                                                                                                    
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts: ["NomeDiv"],                                                                                                                                                                                                        
                                }                                                                                                                                                                                                                              
                            }&nbsp;&nbsp;                                                                                                                                                                                                                      
                        },                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "Comprador(a)",                                                                                                                                                                                                             
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts: ["to_Header/to_eDoc/EkkoUserName"],                                                                                                                                                                                 
                                }&nbsp;                                                                                                                                                                                                                        
                            }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                    
                        },                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "Pedido(s)",                                                                                                                                                                                                                
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts: ["Pedidos"],                                                                                                                                                                                                        
                                }&nbsp;                                                                                                                                                                                                                        
                            }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                    
                        },                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "UF Emitente",                                                                                                                                                                                                              
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts: ["to_Header/to_eDoc/InfnfeEmitEnderemitUf"],                                                                                                                                                                        
                                }&nbsp;                                                                                                                                                                                                                        
                            }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                        
                        },                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "CNPJ do Emitente",                                                                                                                                                                                                         
                            template : {                                                                                                                                                                                                                       
                                content : {                                                                                                                                                                                                                    
                                    parts : ["to_Header/to_eDoc/InfnfeEmitCnpj"],                                                                                                                                                                              
                                    formatter : function(cnpj) {                                                                                                                                                                                               
                                        if (!cnpj) return;                                                                                                                                                                                                     
                                        return cnpj.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/g,"\$1.\$2.\$3\/\$4\-\$5");                                                                                                                                   
                                    }                                                                                                                                                                                                                          
                                }	                                                                                                                                                                                                                             
                            }                                                                                                                                                                                                                                  
                        },                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        {                                                                                                                                                                                                                                      
                            name : "Emitente",                                                                                                                                                                                                                 
                            template : {                                                                                                                                                                                                                       
                                content : {&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                            
                                parts : ["to_Header/to_eDoc/InfnfeEmitXnome"],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n+
bsp;&nbsp;&nbsp;                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                          }                                                                                                                                                                                                                                    
                        }                                                                                                                                                                                                                                      
                    ]                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                // download exported file                                                                                                                                                                                                                      
                oExport.saveFile().catch(function(oError) {                                                                                                                                                                                                    
                    MessageBox.error(                                                                                                                                                                                                                          
                        //this.getView().getModel("i18n").getResourceBundle().getText("DataExportError")                                                                                                                                                       
                        "Error when downloading data. Browser might not be supported!"                                                                                                                                                                         
                        +"\n\n"&nbsp;                                                                                                                                                                                                                          
                        + oError);                                                                                                                                                                                                                             
                }).then(function() {                                                                                                                                                                                                                           
                    oExport.destroy();                                                                                                                                                                                                                         
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                this.oView.setBusy(false);                                                                                                                                                                                                                     
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
			getI18nText: function(key) {                                                                                                                                                                                                                                
				return this.OC.getModel("i18n").getResourceBundle().getText(key);                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
        } // API                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        return API.Export.bind(API);                                                                                                                                                                                                                           
    }                                                                                                                                                                                                                                                          
)                                                                                                                                                                                                                                                              